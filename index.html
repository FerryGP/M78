<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M78æ˜Ÿäº‘ä¸çŒæˆ·åº§ï¼š3Dè§†é”™è§‰æ¢ç©¶ (V7.0)</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #000; color: white; font-family: 'Arial', sans-serif; overflow: hidden; }
        #chart-container { width: 100vw; height: 100vh; }
        .instruction {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            pointer-events: none;
            z-index: 100;
            border: 1px solid #444;
        }
        .instruction h3 { margin-top: 0; color: #87CEFA; }
        .legend-box { margin-top: 10px; font-size: 12px; color: #aaa; }
        .legend-item { display: flex; align-items: center; margin-bottom: 4px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; display: inline-block; }
    </style>
</head>
<body>

    <div class="instruction">
        <h3>M78æ˜Ÿäº‘æ¢ç©¶æ¼”ç¤º (V7 æ ‡å‡†ç‰ˆ)</h3>
        <p>1. <b>å·¦è¾¹ (ä¸œ)ï¼š</b>å‚å®¿å››(ä¸Š)ã€å‚å®¿å…­(ä¸‹)ã€M78ã€‚</p>
        <p>2. <b>å³è¾¹ (è¥¿)ï¼š</b>å‚å®¿äº”(ä¸Š)ã€å‚å®¿ä¸ƒ(ä¸‹)ã€‚</p>
        <p>3. <b>å¯¹è§’çº¿ï¼š</b>å·¦ä¸Šçº¢æ˜Ÿ <-> å³ä¸‹æœ€äº®è“æ˜Ÿã€‚</p>
        <div class="legend-box">
            <div class="legend-item"><span class="dot" style="background:#FF4500"></span>çº¢è¶…å·¨æ˜Ÿ (å‚å®¿å››)</div>
            <div class="legend-item"><span class="dot" style="background:#1E90FF"></span>æœ€äº®è“æ˜Ÿ (å‚å®¿ä¸ƒ)</div>
            <div class="legend-item"><span class="dot" style="background:#E066FF"></span>M78 æ˜Ÿäº‘</div>
        </div>
    </div>

    <div id="chart-container"></div>

    <script>
        // ==========================================
        // 1. å®šä¹‰å¤©ä½“æ•°æ® (V7 ç»å¯¹é”å®šç‰ˆ)
        // ==========================================
        // åæ ‡é€»è¾‘: å±å¹•ä¸­å¿ƒ(0,0)ã€‚
        // Xè½´: è´Ÿæ•°=å·¦(ä¸œ), æ­£æ•°=å³(è¥¿)
        // Yè½´: è´Ÿæ•°=ä¸‹, æ­£æ•°=ä¸Š
        
        const starsData = [
            ["åœ°çƒ (è§‚å¯Ÿç‚¹)", 0, 0, 0, "green", 4, "observer"],
            
            // --- å·¦ä¾§ (ä¸œæ–¹ / Left) ---
            // å‚å®¿å›› (Betelgeuse): å·¦ä¸Š, çº¢è‰²
            ["å‚å®¿å›› (Betelgeuse)", -2, 4, 640, "#FF4500", 25, "star"],   
            // å‚å®¿å…­ (Saiph): å·¦ä¸‹, è“è‰²
            ["å‚å®¿å…­ (Saiph)", -2, -4, 720, "#4169E1", 14, "star"],      
            
            // --- å³ä¾§ (è¥¿æ–¹ / Right) ---
            // å‚å®¿äº” (Bellatrix): å³ä¸Š, è“è‰²
            ["å‚å®¿äº” (Bellatrix)", 2, 4, 250, "#87CEFA", 14, "star"],    
            // å‚å®¿ä¸ƒ (Rigel): å³ä¸‹, æœ€äº®è“æ˜Ÿ
            ["å‚å®¿ä¸ƒ (Rigel)", 2, -4, 860, "#1E90FF", 28, "star"],       
            
            // --- è…°å¸¦ä¸‰æ˜Ÿ (å·¦ä½å³é«˜) ---
            // å‚å®¿ä¸€ (Alnitak): å·¦è¾¹, è¾ƒä½
            ["å‚å®¿ä¸€ (Alnitak)", -0.8, -0.2, 800, "#87CEEB", 12, "star"], 
            // å‚å®¿äºŒ (Alnilam): ä¸­é—´, æœ€è¿œ
            ["å‚å®¿äºŒ (Alnilam)", 0, 0, 2000, "#87CEEB", 12, "star"],      
            // å‚å®¿ä¸‰ (Mintaka): å³è¾¹, è¾ƒé«˜
            ["å‚å®¿ä¸‰ (Mintaka)", 0.8, 0.2, 1200, "#87CEEB", 12, "star"]   
        ];

        // M78 æ˜Ÿäº‘ä½ç½® 
        // ä½äº å‚å®¿ä¸€(å·¦è…°) çš„ å·¦ä¸Šæ–¹
        const m78Pos = {x: -1.4, y: 1.0, z: 1600};

        // ==========================================
        // 2. æ„å»º Plotly æ•°æ®
        // ==========================================
        const traces = [];

        // --- A. æ’æ˜Ÿä¸è§†çº¿ ---
        starsData.forEach(star => {
            const [name, x, y, z, color, size, type] = star;

            // 1. æ˜Ÿæ˜Ÿæœ¬ä½“
            traces.push({
                x: [x], y: [y], z: [z],
                mode: 'markers+text',
                marker: { size: size, color: color, opacity: 1, line: {color: 'white', width: 1} },
                text: [name],
                textposition: "top center",
                textfont: { color: "white", size: 13 },
                type: 'scatter3d',
                name: name,
                hoverinfo: 'text+z'
            });

            // 2. è§†çº¿
            if (type !== "observer") {
                traces.push({
                    x: [0, x], y: [0, y], z: [0, z],
                    mode: 'lines',
                    line: { color: 'gray', width: 1, dash: 'dot' },
                    type: 'scatter3d',
                    showlegend: false,
                    hoverinfo: 'none',
                    opacity: 0.15
                });
            }
        });

        // --- B. M78 æ˜Ÿäº‘ (ç²’å­é›¾æ°”) ---
        const cloudX = [], cloudY = [], cloudZ = [];
        for(let i=0; i<100; i++) {
            cloudX.push(m78Pos.x + (Math.random()-0.5) * 1.5);
            cloudY.push(m78Pos.y + (Math.random()-0.5) * 1.5);
            cloudZ.push(m78Pos.z + (Math.random()-0.5) * 150); 
        }
        
        traces.push({
            x: cloudX, y: cloudY, z: cloudZ,
            mode: 'markers',
            marker: { size: 5, color: '#E066FF', opacity: 0.5 },
            type: 'scatter3d',
            name: 'M78æ˜Ÿäº‘é›¾æ°”',
            hoverinfo: 'none',
            showlegend: false
        });

        // M78 æ ‡ç­¾
        traces.push({
            x: [m78Pos.x], y: [m78Pos.y], z: [m78Pos.z],
            mode: 'markers+text',
            marker: { size: 50, color: 'purple', opacity: 0.2 },
            text: ["<b>M78 æ˜Ÿäº‘</b><br>(æ°”ä½“ 1600å…‰å¹´)"],
            textposition: "top center",
            textfont: { color: "#E066FF", size: 18 },
            type: 'scatter3d',
            name: 'M78 æ˜Ÿäº‘',
            hoverinfo: 'text+z'
        });

        traces.push({
            x: [0, m78Pos.x], y: [0, m78Pos.y], z: [0, m78Pos.z],
            mode: 'lines',
            line: { color: '#E066FF', width: 2, dash: 'dot' },
            type: 'scatter3d',
            showlegend: false,
            opacity: 0.4
        });

        // --- C. çŒæˆ·åº§è¿çº¿ ---
        const connections = [
            [1, 3], // è‚©è†€: å·¦è‚©(4) - å³è‚©(5)
            [1, 5], // å·¦èº«: å‚å®¿å›› - å‚å®¿ä¸€
            [3, 7], // å³èº«: å‚å®¿äº” - å‚å®¿ä¸‰
            [5, 2], // å·¦è…¿: å‚å®¿ä¸€ - å‚å®¿å…­
            [7, 4], // å³è…¿: å‚å®¿ä¸‰ - å‚å®¿ä¸ƒ
            [5, 6], // è…°å¸¦: ä¸€ - äºŒ
            [6, 7]  // è…°å¸¦: äºŒ - ä¸‰
        ];

        connections.forEach(pair => {
            const s = starsData[pair[0]];
            const e = starsData[pair[1]];
            traces.push({
                x: [s[1], e[1]], y: [s[2], e[2]], z: [s[3], e[3]],
                mode: 'lines',
                line: { color: 'white', width: 4 },
                type: 'scatter3d',
                showlegend: false,
                hoverinfo: 'none'
            });
        });

        // ==========================================
        // 3. å¸ƒå±€è®¾ç½®
        // ==========================================
        const layout = {
            title: {
                text: 'M78æ˜Ÿäº‘ä¸çŒæˆ·åº§ï¼š3Dæ¨¡å‹ (V7.0)',
                font: { color: 'white', size: 24 }
            },
            paper_bgcolor: 'black',
            plot_bgcolor: 'black',
            showlegend: false,
            scene: {
                xaxis: { title: '', range: [-5, 5], showgrid: false, zeroline: false, showticklabels: false },
                yaxis: { title: '', range: [-5, 5], showgrid: false, zeroline: false, showticklabels: false },
                zaxis: { 
                    title: 'è·ç¦»åœ°çƒ (å…‰å¹´)', 
                    range: [0, 2200], 
                    showgrid: true, 
                    gridcolor: '#333', 
                    zerolinecolor: '#666', 
                    color: '#aaa' 
                },
                aspectmode: 'manual',
                aspectratio: { x: 1, y: 1, z: 2.5 }, 
                camera: {
                    eye: { x: 0, y: 0, z: -0.1 }, 
                    up: { x: 0, y: 1, z: 0 }
                }
            },
            updatemenus: [{
                type: 'buttons',
                direction: 'left',
                x: 0.05, y: 0.05, xanchor: 'left',
                font: { color: 'black' },
                bgcolor: '#f0f0f0',
                bordercolor: '#ccc',
                borderwidth: 1,
                buttons: [
                    {
                        label: "ğŸŒ åŒ—äº¬è§‚æµ‹è§†è§’",
                        method: "relayout",
                        args: [{
                            "scene.camera.eye": { x: 0.001, y: 0.001, z: -0.1 },
                            "scene.camera.up": { x: 0, y: 1, z: 0 },
                            "scene.camera.center": { x: 0, y: 0, z: 0 },
                            "title.text": "åŒ—äº¬è§‚æµ‹ï¼šå·¦ä¸Šå‚å®¿å››(çº¢)ï¼Œå³ä¸‹å‚å®¿ä¸ƒ(è“)"
                        }]
                    },
                    {
                        label: "ğŸ›¸ ä¾§é¢çœŸç›¸ (æ·±åº¦)",
                        method: "relayout",
                        args: [{
                            "scene.camera.eye": { x: 2.5, y: 0.8, z: 0.3 }, 
                            "scene.camera.center": { x: 0, y: 0, z: 0 },
                            "scene.camera.up": { x: 0, y: 1, z: 0 },
                            "title.text": "çœŸç›¸ï¼šä¸­é—´çš„å‚å®¿äºŒ å…¶å®æœ€è¿œ(2000å…‰å¹´)ï¼"
                        }]
                    }
                ]
            }]
        };

        Plotly.newPlot('chart-container', traces, layout, {responsive: true});

    </script>
</body>
</html>